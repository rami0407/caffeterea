<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ØªØµÙØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© - Ù…Ù‚ØµÙ Ø§Ù„Ù…Ø¹Ø±ÙØ©">
    <title>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© | Ù…Ù‚ØµÙ Ø§Ù„Ù…Ø¹Ø±ÙØ©</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&family=Heebo:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/guest.css">
    <style>
        /* Password Protection Styles */
        body.locked {
            overflow: hidden;
        }

        body.locked>*:not(#passwordModal) {
            filter: blur(8px);
            pointer-events: none;
            user-select: none;
        }

        #passwordModal {
            display: none;
            /* Flex when active */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .auth-box {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .auth-box h2 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .auth-box input {
            width: 100%;
            padding: 12px;
            margin: 1rem 0;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 1.1rem;
            text-align: center;
        }

        .auth-box button {
            width: 100%;
            padding: 12px;
            background: var(--primary-dark);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
        }

        .auth-error {
            color: #ef4444;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            display: none;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="guest-header">
        <a href="index.html" class="logo-link">
            <span class="logo-icon">ğŸŒ±</span>
            <span class="logo-text">Ù…Ù‚ØµÙ Ø§Ù„Ù…Ø¹Ø±ÙØ©</span>
        </a>
        <div class="header-actions">
            <a href="login.html?role=student" class="login-link">
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
                <span>â†’</span>
            </a>
            <div class="lang-mini">
                <button class="lang-mini-btn active" data-lang="ar">Ø¹</button>
                <button class="lang-mini-btn" data-lang="he">×¢</button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="guest-hero">
        <h1>ğŸ½ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‚ØµÙ</h1>
        <p>ØªØµÙØ­ Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§ Ø§Ù„ØµØ­ÙŠØ© ÙˆØ§Ù„Ù„Ø°ÙŠØ°Ø©</p>
    </section>

    <!-- Categories -->
    <nav class="guest-categories">
        <button class="category-chip active" data-category="all">ğŸ½ï¸ Ø§Ù„ÙƒÙ„</button>
        <button class="category-chip" data-category="sandwiches">ğŸ¥ª Ø³Ù†Ø¯ÙˆÙŠØ´Ø§Øª</button>
        <button class="category-chip" data-category="drinks">ğŸ¥¤ Ù…Ø´Ø±ÙˆØ¨Ø§Øª</button>
        <button class="category-chip" data-category="snacks">ğŸª ÙˆØ¬Ø¨Ø§Øª Ø®ÙÙŠÙØ©</button>
        <button class="category-chip" data-category="healthy">ğŸ¥— ØµØ­ÙŠ</button>
    </nav>

    <!-- Products Grid -->
    <main class="guest-content">
        <div class="guest-products" id="productsGrid">
            <!-- Products will be loaded here -->
        </div>
    </main>

    <!-- Nutrition Legend -->
    <section class="nutrition-legend">
        <h3>ğŸš¦ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø¶ÙˆØ¦ÙŠØ© Ù„Ù„ØªØºØ°ÙŠØ©</h3>
        <div class="legend-items">
            <div class="legend-item green">
                <span class="dot"></span>
                <span>Ø£Ø®Ø¶Ø±: Ø®ÙŠØ§Ø± ØµØ­ÙŠ Ù…Ù…ØªØ§Ø²</span>
            </div>
            <div class="legend-item yellow">
                <span class="dot"></span>
                <span>Ø£ØµÙØ±: Ù…ØªÙˆØ³Ø· - Ø¨Ø§Ø¹ØªØ¯Ø§Ù„</span>
            </div>
            <div class="legend-item red">
                <span class="dot"></span>
                <span>Ø£Ø­Ù…Ø±: Ø­Ù„ÙˆÙ‰ - Ø£Ø­ÙŠØ§Ù†Ø§Ù‹</span>
            </div>
        </div>
    </section>

    <!-- CTA -->
    <section class="guest-cta">
        <h2>ğŸ‰ Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§!</h2>
        <p>Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù† Ù„Ù„Ø·Ù„Ø¨ ÙˆØ§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</p>
        <a href="login.html?role=student" class="btn btn-primary">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a>
    </section>

    <!-- Footer -->
    <footer class="guest-footer">
        <p>ğŸŒ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø®Ø¶Ø± | Ù…Ù‚ØµÙ Ø§Ù„Ù…Ø¹Ø±ÙØ© Â© 2024</p>
    </footer>

    <!-- Cart Fab -->
    <div class="cart-fab" onclick="openCart()">
        <span class="cart-icon">ğŸ›’</span>
        <span class="cart-badge" id="cartCount" style="display: none;">0</span>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="cart-modal">
        <div class="cart-modal-content">
            <div class="cart-header">
                <h3>Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                <button class="close-btn" onclick="closeCart()">Ã—</button>
            </div>

            <div id="cartItems" class="cart-items">
                <!-- Items will be here -->
            </div>

            <div class="cart-footer">
                <div class="total-row">
                    <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
                    <span id="cartTotal">0</span>
                    <span>Ù†Ù‚Ø·Ø©</span>
                </div>

                <div class="guest-input-group">
                    <label>Ø§Ù„Ø§Ø³Ù… (Ù…Ø·Ù„ÙˆØ¨ Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨)</label>
                    <input type="text" id="guestNameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." class="guest-name-input">
                </div>

                <button id="btnCheckout" class="btn btn-primary btn-full" onclick="submitGuestOrder()">ØªØ£ÙƒÙŠØ¯
                    Ø§Ù„Ø·Ù„Ø¨</button>
            </div>
        </div>
    </div>

    <!-- Password Protection Modal -->
    <div id="passwordModal">
        <div class="auth-box">
            <h2>ğŸ”’ ØµÙØ­Ø© Ù…Ø­Ù…ÙŠØ©</h2>
            <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù‚ØµÙ</p>
            <input type="password" id="pagePassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button onclick="checkPagePassword()">Ø¯Ø®ÙˆÙ„</button>
            <p id="passwordError" class="auth-error">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/guest.js"></script>
    <script>
        // Sample products (Keep data here for now or move to DB later)
        const products = [
            { id: '1', name: 'Ø³Ù†Ø¯ÙˆÙŠØ´ Ø¬Ø¨Ù†Ø© ØµÙØ±Ø§Ø¡', price: 5, category: 'sandwiches', icon: 'ğŸ§€', trafficLight: 'yellow' },
            { id: '2', name: 'Ø³Ù†Ø¯ÙˆÙŠØ´ Ù„Ø¨Ù†Ø© ÙˆØ²Ø¹ØªØ±', price: 4, category: 'sandwiches', icon: 'ğŸ¥™', trafficLight: 'green' },
            { id: '3', name: 'Ø³Ù†Ø¯ÙˆÙŠØ´ Ø­Ù…Øµ', price: 4, category: 'sandwiches', icon: 'ğŸ¥™', trafficLight: 'green' },
            { id: '4', name: 'Ø¹ØµÙŠØ± Ø¨Ø±ØªÙ‚Ø§Ù„ Ø·Ø¨ÙŠØ¹ÙŠ', price: 6, category: 'drinks', icon: 'ğŸŠ', trafficLight: 'green' },
            { id: '5', name: 'Ù…Ø§Ø¡ Ù…Ø¹Ø¯Ù†ÙŠ', price: 2, category: 'drinks', icon: 'ğŸ’§', trafficLight: 'green' },
            { id: '6', name: 'Ø¹ØµÙŠØ± ØªÙØ§Ø­', price: 5, category: 'drinks', icon: 'ğŸ', trafficLight: 'yellow' },
            { id: '7', name: 'Ø¨Ø³ÙƒÙˆÙŠØª Ø´ÙˆÙØ§Ù†', price: 3, category: 'snacks', icon: 'ğŸª', trafficLight: 'yellow' },
            { id: '8', name: 'ÙƒØ¹ÙƒØ© ØªÙ…Ø±', price: 4, category: 'snacks', icon: 'ğŸ§', trafficLight: 'yellow' },
            { id: '9', name: 'Ø³Ù„Ø·Ø© Ø®Ø¶Ø§Ø±', price: 6, category: 'healthy', icon: 'ğŸ¥—', trafficLight: 'green' },
            { id: '10', name: 'ÙÙˆØ§ÙƒÙ‡ Ù…Ù‚Ø·Ø¹Ø©', price: 5, category: 'healthy', icon: 'ğŸ‡', trafficLight: 'green' },
            { id: '11', name: 'Ù„Ø¨Ù† Ø²Ø¨Ø§Ø¯ÙŠ', price: 3, category: 'healthy', icon: 'ğŸ¥›', trafficLight: 'green' },
            { id: '12', name: 'Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©', price: 4, category: 'snacks', icon: 'ğŸ«', trafficLight: 'red' }
        ];

        let currentCategory = 'all';

        document.addEventListener('DOMContentLoaded', () => {
            // Check Access
            checkAccess();

            initI18n();
            renderProducts(); // From guest.js

            // Category buttons
            document.querySelectorAll('.category-chip').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.category-chip').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCategory = btn.dataset.category;
                    renderProducts(); // Re-render
                });
            });

            // Language buttons
            document.querySelectorAll('.lang-mini-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.lang-mini-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    setLanguage(btn.dataset.lang);
                });
            });
        });

        // Guest Page Security
        function checkAccess() {
            const isAuthorized = sessionStorage.getItem('guest_access');
            if (isAuthorized !== 'true') {
                document.body.classList.add('locked');
                document.getElementById('passwordModal').style.display = 'flex';
            }
        }

        function checkPagePassword() {
            const input = document.getElementById('pagePassword');
            const error = document.getElementById('passwordError');

            if (input.value === '123456') {
                sessionStorage.setItem('guest_access', 'true');
                document.body.classList.remove('locked');
                document.getElementById('passwordModal').style.display = 'none';
            } else {
                error.style.display = 'block';
                input.value = '';
                input.focus();
            }
        }
    </script>
</body>

</html>